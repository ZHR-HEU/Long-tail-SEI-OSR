# ğŸš€ ä¸¤é˜¶æ®µé•¿å°¾å¼€é›†è®­ç»ƒ - å¿«é€Ÿä¸Šæ‰‹

## ä¸€ã€æœ€å¿«ä¸Šæ‰‹æ–¹å¼ï¼ˆ3æ­¥ï¼‰

### 1ï¸âƒ£ æ£€æŸ¥æ•°æ®è·¯å¾„

```bash
# ç¡®è®¤æ•°æ®æ–‡ä»¶å­˜åœ¨
ls -lh /home/dell/md3/zhahaoran/data/*.mat
```

å¦‚æœè·¯å¾„ä¸å¯¹ï¼Œç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š
```bash
vim config_openset_twostage.yaml
# ä¿®æ”¹ç¬¬29-30è¡Œçš„ path_train å’Œ path_test
```

### 2ï¸âƒ£ ç›´æ¥è¿è¡Œ

```bash
python train_openset_twostage.py
```

### 3ï¸âƒ£ æŸ¥çœ‹ç»“æœ

```bash
# è®­ç»ƒå®ŒæˆåæŸ¥çœ‹æœ€ç»ˆç»“æœ
cat checkpoints/stage2/final_results.txt
```

---

## äºŒã€è®­ç»ƒè¿‡ç¨‹è¯´æ˜

### è®­ç»ƒæµç¨‹

```
å¼€å§‹
  â†“
Stage 1: è¡¨ç¤ºå­¦ä¹ ï¼ˆçº¦30-60åˆ†é’Ÿï¼‰
  - åªåœ¨å·²çŸ¥ç±»ä¸Šè®­ç»ƒ
  - å­¦ä¹ å¥½çš„ç‰¹å¾è¡¨ç¤º
  - ä¿å­˜backboneæ¨¡å‹
  â†“
Stage 2: åˆ†ç±»å™¨é‡è®­ç»ƒ + å¼€é›†æ£€æµ‹ï¼ˆçº¦30-60åˆ†é’Ÿï¼‰
  - å†»ç»“backbone
  - é‡æ–°è®­ç»ƒåˆ†ç±»å™¨ï¼ˆå¤„ç†é•¿å°¾ï¼‰
  - è®­ç»ƒå¼€é›†æ£€æµ‹å™¨
  - ä¿å­˜æœ€ç»ˆæ¨¡å‹
  â†“
å®Œæˆï¼æŸ¥çœ‹ç»“æœ
```

### é¢„æœŸè®­ç»ƒæ—¶é—´

- **GPU (RTX 3090)**: 1-2å°æ—¶
- **GPU (GTX 1080)**: 2-4å°æ—¶
- **CPU**: 8-12å°æ—¶ï¼ˆä¸æ¨èï¼‰

---

## ä¸‰ã€æ ¸å¿ƒé…ç½®å‚æ•°

### å¿…é¡»ä¿®æ”¹çš„å‚æ•°

```yaml
# config_openset_twostage.yaml

data:
  path_train: "ä½ çš„è®­ç»ƒæ•°æ®.mat"     # â† å¿…é¡»ä¿®æ”¹
  path_test: "ä½ çš„æµ‹è¯•æ•°æ®.mat"      # â† å¿…é¡»ä¿®æ”¹
  num_known_classes: 6               # â† æ ¹æ®æ•°æ®é›†è°ƒæ•´
```

### å¸¸ç”¨è°ƒæ•´å‚æ•°

```yaml
# å¦‚æœæ˜¾å­˜ä¸è¶³
data:
  batch_size: 128    # é»˜è®¤256ï¼Œæ”¹å°

# å¦‚æœè®­ç»ƒå¤ªæ…¢
stage1:
  epochs: 100        # é»˜è®¤200ï¼Œå‡å°‘
stage2:
  epochs: 100
```

---

## å››ã€å¸¸è§å‘½ä»¤

### åŸºç¡€è¿è¡Œ

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®è¿è¡Œ
python train_openset_twostage.py

# æŒ‡å®šé…ç½®æ–‡ä»¶
python train_openset_twostage.py --config config_openset_twostage.yaml
```

### åå°è¿è¡Œï¼ˆæ¨èé•¿æ—¶é—´è®­ç»ƒï¼‰

```bash
# æ–¹å¼1: ä½¿ç”¨ nohup
nohup python train_openset_twostage.py > training.log 2>&1 &

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f training.log

# æ–¹å¼2: ä½¿ç”¨ tmuxï¼ˆæ¨èï¼‰
tmux new -s train
python train_openset_twostage.py
# æŒ‰ Ctrl+B ç„¶åæŒ‰ D åˆ†ç¦»ä¼šè¯
# é‡æ–°è¿æ¥: tmux attach -t train
```

### ç›‘æ§è®­ç»ƒ

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f training.log

# æŸ¥çœ‹GPUä½¿ç”¨æƒ…å†µ
nvidia-smi

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep train_openset_twostage
```

---

## äº”ã€è¾“å‡ºæ–‡ä»¶è¯´æ˜

### ç›®å½•ç»“æ„

```
checkpoints/
â”œâ”€â”€ stage1/
â”‚   â””â”€â”€ best_model.pth          â† Stage-1æœ€ä½³æ¨¡å‹
â””â”€â”€ stage2/
    â”œâ”€â”€ best_model.pth          â† æœ€ç»ˆæ¨¡å‹ï¼ˆç”¨è¿™ä¸ªï¼ï¼‰
    â””â”€â”€ final_results.txt       â† æµ‹è¯•ç»“æœï¼ˆçœ‹è¿™ä¸ªï¼ï¼‰
```

### å…³é”®ç»“æœæŒ‡æ ‡

```
final_results.txt ä¸­çš„æŒ‡æ ‡ï¼š

Closed-Set Performance:
  Closed-Set Accuracy: 0.7856    â† å·²çŸ¥ç±»å‡†ç¡®ç‡ï¼ˆè¶Šé«˜è¶Šå¥½ï¼Œç›®æ ‡>75%ï¼‰

Open-Set Performance:
  AUROC: 0.8912                  â† å¼€é›†æ£€æµ‹èƒ½åŠ›ï¼ˆè¶Šé«˜è¶Šå¥½ï¼Œç›®æ ‡>85%ï¼‰
  OSCR: 0.8123                   â† ç»¼åˆæŒ‡æ ‡ï¼ˆè¶Šé«˜è¶Šå¥½ï¼Œç›®æ ‡>75%ï¼‰

Long-Tail Analysis:
  Many-shot Acc: 0.8945          â† å¤´éƒ¨ç±»å‡†ç¡®ç‡
  Few-shot Acc: 0.6234           â† å°¾éƒ¨ç±»å‡†ç¡®ç‡ï¼ˆå·®è·è¶Šå°è¶Šå¥½ï¼‰
```

---

## å…­ã€å¿«é€Ÿè°ƒä¼˜æŒ‡å—

### é—®é¢˜1: æ˜¾å­˜ä¸è¶³ï¼ˆCUDA out of memoryï¼‰

```yaml
data:
  batch_size: 64     # æ”¹å°ï¼ˆåŸæ¥æ˜¯256ï¼‰
```

### é—®é¢˜2: å¼€é›†æ£€æµ‹æ•ˆæœå·®ï¼ˆAUROC < 0.7ï¼‰

```yaml
# å°è¯•ä¸åŒçš„æ£€æµ‹å™¨
stage2:
  openset:
    detector_type: "odin"    # æ”¹æˆ odin æˆ– energy

# æˆ–å¢åŠ è®­ç»ƒè½®æ•°
stage1:
  epochs: 300
```

### é—®é¢˜3: å°¾éƒ¨ç±»å‡†ç¡®ç‡ä½ï¼ˆFew-shot Acc < 0.5ï¼‰

```yaml
# ä½¿ç”¨æ›´å¼ºçš„é‡é‡‡æ ·
stage2:
  sampling_strategy: "class_uniform"  # å®Œå…¨å¹³è¡¡é‡‡æ ·

# ä½¿ç”¨ä»£ä»·æ•æ„ŸæŸå¤±
stage2:
  loss:
    name: "CostSensitiveCE"
```

### é—®é¢˜4: è®­ç»ƒå¤ªæ…¢

```yaml
# å‡å°‘è½®æ•°ï¼ˆå¿«é€Ÿå®éªŒï¼‰
stage1:
  epochs: 50
stage2:
  epochs: 50

# å¢å¤§batch sizeï¼ˆå¦‚æœæ˜¾å­˜å¤Ÿï¼‰
data:
  batch_size: 512
  num_workers: 8
```

---

## ä¸ƒã€å®Œæ•´è¿è¡Œç¤ºä¾‹

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/user/Long-tail-SEI-OSR

# 2. æ£€æŸ¥æ•°æ®è·¯å¾„
grep "path_train\|path_test" config_openset_twostage.yaml

# 3. å¯åŠ¨è®­ç»ƒï¼ˆåå°è¿è¡Œï¼‰
nohup python train_openset_twostage.py > training.log 2>&1 &

# 4. æŸ¥çœ‹è®­ç»ƒè¿›åº¦ï¼ˆå¦å¼€ç»ˆç«¯ï¼‰
tail -f training.log

# 5. è®­ç»ƒå®ŒæˆåæŸ¥çœ‹ç»“æœ
cat checkpoints/stage2/final_results.txt

# 6. å¦‚æœè¦åœæ­¢è®­ç»ƒ
# æŸ¥æ‰¾è¿›ç¨‹ID
ps aux | grep train_openset_twostage
# æ€æ­»è¿›ç¨‹
kill <è¿›ç¨‹ID>
```

---

## å…«ã€ä¸åŒåœºæ™¯çš„é…ç½®å»ºè®®

### åœºæ™¯A: å¿«é€Ÿæµ‹è¯•ï¼ˆ10åˆ†é’Ÿè·‘å®Œï¼‰

```yaml
stage1:
  epochs: 10
stage2:
  epochs: 10
```

### åœºæ™¯B: æ ‡å‡†è®­ç»ƒï¼ˆ1-2å°æ—¶ï¼‰

```yaml
stage1:
  epochs: 200
stage2:
  epochs: 200
```

### åœºæ™¯C: è¿½æ±‚æœ€é«˜æ€§èƒ½ï¼ˆ3-4å°æ—¶ï¼‰

```yaml
stage1:
  epochs: 300
  diffusion:
    enabled: true
stage2:
  epochs: 300
  openset:
    detector_type: "openmax"
```

---

## ä¹ã€å¸¸è§é”™è¯¯å¿«é€Ÿè§£å†³

| é”™è¯¯ä¿¡æ¯ | è§£å†³æ–¹æ³• |
|---------|---------|
| `FileNotFoundError: *.mat` | ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®è·¯å¾„ |
| `Unknown norm kind: batch_norm` | æ”¹ä¸º `norm_kind: "auto"` |
| `CUDA out of memory` | å‡å° batch_size åˆ° 64 æˆ– 128 |
| `No module named 'xxx'` | `pip install xxx` |
| `Training too slow` | æ”¹ç”¨GPUï¼Œå¢åŠ  num_workers |
| `AUROC too low` | å¢åŠ è®­ç»ƒè½®æ•°ï¼Œæ¢æ£€æµ‹å™¨ |

---

## åã€è·å–å¸®åŠ©

### æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£
```bash
cat RUN_GUIDE.md        # è¯¦ç»†è¿è¡ŒæŒ‡å—
cat README.md           # é¡¹ç›®è¯´æ˜
```

### æ£€æŸ¥ä»£ç 
```bash
# æŸ¥çœ‹è®­ç»ƒè„šæœ¬å¸®åŠ©
python train_openset_twostage.py --help

# æŸ¥çœ‹é…ç½®æ–‡ä»¶
cat config_openset_twostage.yaml
```

---

## ğŸ‰ å¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡è®­ç»ƒï¼

```bash
# å°±è¿™ä¸€æ¡å‘½ä»¤ï¼
python train_openset_twostage.py
```

**é¢„è®¡è®­ç»ƒæ—¶é—´**: 1-2å°æ—¶ (GPU)
**é¢„æœŸå‡†ç¡®ç‡**: Closed-Set Acc > 75%, AUROC > 85%

ğŸš€ **ç¥è®­ç»ƒæˆåŠŸï¼**
